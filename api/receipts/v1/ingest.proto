syntax = "proto3";

package receipts.v1;

option go_package = "github.com/joseph-ayodele/receipts-tracker/gen/proto/receipts/v1;v1";

message IngestFileRequest {
  string profile_id = 1; // required (UUID)
  string path = 2;       // absolute or project-local file path
}

message IngestResponse {
  string file_id = 1;           // receipt_files.id (UUID)
  bool deduplicated = 2;        // true if (profile_id, content_hash) already existed
  string content_hash_hex = 3;  // hex(sha256)
  string file_ext = 4;          // normalized ext
  string uploaded_at = 5;       // RFC3339
  string source_path = 6;       // echoed canonical path
  string error = 7;             // non-empty on failure (directory ingest keeps walking)
}

message IngestDirectoryRequest {
  string profile_id = 1;         // required (UUID)
  string root_path = 2;          // required; directory to walk
  repeated string include_exts = 3; // optional; defaults to ["pdf","jpg","jpeg","png"] (case-insensitive)
  bool skip_hidden = 4;          // optional; default true - skip dotfiles and dot-dirs
}

message IngestDirectoryResponse {
  uint32 scanned = 1;       // FS entries visited
  uint32 matched = 2;       // files matching ext filter
  uint32 succeeded = 3;     // successful insert or dedup
  uint32 deduplicated = 4;  // subset of succeeded
  uint32 failed = 5;        // failures
  repeated IngestResponse results = 6;
}

service IngestionService {
  rpc IngestFile(IngestFileRequest) returns (IngestResponse);
  rpc IngestDirectory(IngestDirectoryRequest) returns (IngestDirectoryResponse);
}
